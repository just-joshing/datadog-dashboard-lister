name: Datadog Dashboard Lister

on: [push, workflow_dispatch]

jobs:
  datadog_dashboard_lister_job:
    runs-on: ubuntu-latest
    name: A job to list datadog dashboards
    steps:
    - name: Check out GitHub Pages branch
      uses: actions/checkout@v2
      with:
        ref: 'test-output'
        path: 'out'
    - name: Datadog Dashboard Lister action step
      id: dd-dashboard-lister
      uses: just-joshing/datadog-dashboard-lister@main
      with:
        datadog-api-key: "${{ secrets.DD_API_KEY }}"
        datadog-app-key: "${{ secrets.DD_APP_KEY }}"
        filter-titles-by-keywords: '["secret"]'
    - name: Publish dashboard
      run: |
        git add .
        git config user.name 'Joshua French'
        git config user.email 'just-joshing@github.com'
        git commit -m 'Update datadog dashboard list' --allow-empty
        git push origin test-output
      working-directory: out
